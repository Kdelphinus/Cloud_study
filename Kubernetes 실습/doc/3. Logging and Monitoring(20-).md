# Logging and Monitoring (Section 20 - )

## Section 20: Kubernetes Cluster Logging

- 우리가 수동으로 로그를 확인할 때는 대체로 클러스터를 구성하고 실행하는 단계였다.
- 하지만 클러스터가 정상 동작을 할 때도 로그를 파악한다면 여러 정보를 얻을 수 있다.
- 그러나 로그가 너무 많기 때문에 포드 하나씩 로그를 직접 살펴볼 수는 없다.

### ELK 스택(Elastic Stack) 개념

#### 구성 서비스

1. Logstash or Fluentd

- 노드에 컨테이너들이 있을 때, 컨테이너들은 로그를 쓴다. 이러한 로그들을 모으는 프로그램이 logstash이다.
- 같은 노드에서 컨테이너로 존재한다.
- Fluentd 역시 Logstash와 동일한 역할을 수행하며 둘 중의 하나를 선택하는 형태로 스택이 구성된다.

2. Elasticsearch

- 엘라스틱서치는 분산 서치이고 분석 엔진이다.
- 즉, 엘라스틱서치로 어떤 데이터라도 엘라스틱서치 데이터베이스에 저장하고 쿼리할 수 있다.
- 서치 엔진 실행 파트로 봐도 된다.

3. Kibana

- 엘라스틱서치의 데이터를 시각화 해주는 도구다.
- 그래프, 차트 등 데이터를 정제하고 시각화하는 다양한 기능들이 있다.

#### 클러스터 설치

- 로그스태시는 클러스터에 있는 모든 싱글 노드에 설치해야 한다.
- 엘라스틱서치와 키바나는 원하는 방식으로 구성할 수 있다.
  - aws는 엘라스틱서치 서비스를 지원한다. 이를 통해 구성할 수도 있다. 이는 클러스터 밖에서 안정적이고 강력하게 실행할 수 있다는 장점이 있다.
  - 키바나는 웹 앱이기에 어느 곳에든 설치할 수 있다. 오직 키바나만 실행되는 ec2 인스턴스를 설정할 수도 있다.
  - 간단하고 빠르고 지저분한 방법은 쿠버네티스 클러스터에 직접 배포하는 방법이다.
    - 플루언티드는 각 노드에 설치되어야 한다.
    - 엘라스틱서치는 시스템에 적어도 2개의 노드에서 복제되도록 만들어 엘라스틱서치 서비스가 중단되지 않고 로그가 저장되지 않는 것을 방지한다.
    - 키바나는 임의의 싱글 노드에 설치한다.
    - 이 방법은 새로운 인스턴스를 사용하지 않기 때문에 간단하고 빠르다.
    - 하지만 노드에 포드가 계속해서 추가되기에 잠재적으로 노드에 과부하를 계속 준다.


### ELK 스택 설치

