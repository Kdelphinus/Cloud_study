# 04. AWS 네트워크 - VPC, Direct Connect, CloudFront

## VPC(Virtual Private Cloud)

- 기업용 가상 프라이빗 클라우드, 기업용 전용 클라우드
- 리전별 클라우드 데이터센터 구현 체계
- 퍼블릭 네트워크 + 프라이빗 네트워크 로 구성
- 클라우드 리소스를 논리적 영역(서브넷)에 격리

### VPC 활용 및 네트워크 연계

- 하나의 VPC는 퍼블릭 및 프라이빗 서브넷으로 구성
  - 예) 퍼블릭 서브넷: App 서버 구성 / 프라이빗 서브넷: DB 서버 구성
- VPC 피어링: 서로 다른 VPC 간의 일대일 연결(크로스 리전)
- VPC 엔드포인트: 다른 VPC 내 리소스, S3, DynamoDB 등 연결
- Direct Connect: AWS-온프레미스를 프라이빗 전용선으로 연결
- VPN(Direct Connect와 다르게 공개선으로 연결), Transit Gateway(네트워크 허브로 이해하기): AWS-온프레미스 연결(크로스 리전)

### 기본 VPC

- AWS 계정 생성 시, 글로벌 리전별 VPC도 함께 생성
- 새 EC2 인스턴스 생성 시, 기본 VPC 내에 생성된다.
- 필요 시, 서브넷 추가 및 라우트 테이블 변경 가능
- 네트워크 제어 규칙 추가: 보안 그룹, NACL
- Public, Private IPv4 DNS 네임 보유
- 기본 VPC는 인터넷 연결 가능

### VPC 서브넷

- 서브넷: VPC라는 단일 네트워크의 논리적 분할
- 퍼블릭 서브넷: 기업 웹 페이지 등 인터넷 연결용
- 프라이빗 서브넷: 데이터베이스 등 배타적 보안성 연결
- 워크로드 기준: dev 서브넷, test 서브넷 구성
- 인터넷과 연결하려면 Internet gateway를 사용해야 한다.
- 만약 프라이빗 서브넷이 인터넷을 사용해야 한다면 Net gateway 와 같은 별도의 인터넷 연결을 처리하는 서비스를 사용해야 한다.

#### 서브넷 생성

- VPC의 [CIDR 블록](https://aws.amazon.com/ko/what-is/cidr/)으로 서브넷 정의
- 최소 서브넷: /28 (16개의 IP 주소 생성)
- AZ 리소스(다른 AZ의 서브넷과 연결 불가)
- 예) AZ가 3개인 경우, 세 개의 서브넷을 생성하고 관리한다.

### 라우트 테이블(route table)

- 서브넷에 포함된 트래픽 전송 규칙
- 목적지에 데이터 패킷 전송을 위한 정보가 담겨있음
- 대상(주소) + 타겟(리소스)로 구성
- 대상(Destination): 목적지(IP 주소)
- 타겟(Target): local, igw- 등 (주소 내 리소스, 위치)

### 인터넷 게이트웨이(igw-)

- VPC의 인터넷 연결 지원
- IPv4, IPv6 트래픽 모두 지원
- 서브넷에서 인터넷으로 바로 연결
- 확장성, 중복구현성, 고가용성을 가진 VPC 컴포넌트
- 라우트 테이블에 인터넷 게이트웨이 엔트리를 추가할 수 있음
  - 예) 0.0.0.0/0: igw-11aa33cc

### NACL - 서브넷 네트워크 보안

- 서브넷 레벨 방화벽, 스테이트리스 속성
- VPC는 기본 설정으로 NACL을 제공
- IPv4, IPv6의 인바운드와 아웃바운드 트래픽을 필터링
- 커스텀 NACL 추가 가능(기본: 모든 트래픽 차단)
- 허용 및 거부 규칙을 모두 지닐 수 있다.

- EC2 인스턴스의 ENI에 포함된 보안그룹도 네트워크 보안
- 보안그룹: 인스턴스 레벨 방화벽, 스테이트풀 속성
- 보안그룹이 외부로 나가거나 외부에서 들어올 때, NACL을 거쳐서 나가거나 들어간다.

## 클라우드 네트워크의 확장

- 온프레미스와 클라우드 연결: VPN, Direct Connect, Transit Gateway
- CDN(Contents Delivery Network) 서비스: CloudFront
- DNS(Domain Name System) 서비스: Route53

## 온프레미스와 클라우드 연결

### VPN(Virtual Private Network)

- 클라우드와 온프레미스 네트워크 연결
- 퍼블릭 인터넷망 이용하기에 암호화가 필요
- VPG(Virtual Private Gateway)와 고객 게이트웨이를 설정해야 한다.
- VPN에서 AWS 내부의 Transit Gateway를 거쳐 각 VPC로 연결된다.

### Direct Connect

- 클라우드와 온프레미스 네트워크 연결
- 기업 전용 프라이밋 인터넷망을 이용하기에 암호화가 불필요하다.
- 대량 데이터, 실시간 데이터, 퍼블릭 인터넷망으로 보낼 수 없는 것이 있을 때 사용한다.
- Direct Connect Gateway: 리전 내 다수 VPC 연결
- AWS VPC에는 Virtual Private Gateway, 고객 쪽에는 Customer Router/Firewall 이 Direct Connect 와 연결되어 있다.

## CDN(Content Delivery Network)

- 지리적으로 분산된 서버들을 연결한 네트워크
- 웹 컨텐츠의 복사본을 사용자와 가까운 곳에 두거나 동적 컨텐츠의 전달을 활성화하여 웹 성능 및 속도를 향상한다.
- 예) 넷플릭스에서 하나의 컨텐츠를 볼 떄 처음엔 미국 본사 서버에서 데이터를 받아와야 한다. 하지만 한국에 많은 요청이 생기면 한국과 가까운 Edge Location에 사본을 많이 만들어두고 한국에서 오는 요청은 Edge Location에서 처리하게 만든다. 그리고 요청이 줄면 자동으로 사본의 개수도 줄이도록 만들 수 있다.

### CloudFront

- 빠르고 안전하게 웹 콘텐츠를 전송하는 CDN 서비스
- 동적 콘텐츠 전송, API 가속화, 비디오 스트리밍, S/W 업데이트 배포 등에 주로 사용
- 읽기 성능 향상, 콘텐츠는 엣지 로케이션에 캐싱
- 글로벌 450여개의 엣지 로케이션으로 전송 속도 향상
- 사용자와 가깝기에 보안에 취약하다. 그렇기에 Shield, WAF 등으로 보안

#### CloudFront 오리진

- 원본이 있는 곳을 오리진이라고 한다.
- S3 버킷, S3 정적 웹사이트에 주로 저장되어 있음
- 그 외에도 EC2 인스턴스, ALB, HTTP 백엔드도 CloudFront 오리진으로 지정할 수 있다.

> #### 캐싱(Caching)
> 
> 캐싱은 원본(origin)에 대한 임시 복사본(cached copy)의 개념으로, 대규모의 수요는 원본 서버와 함께 요청량에 비례하여 확장된 엣지 캐시 서버에서 처리하여 성능을 높인다.
> 한국 넷플릭스에서 '기묘한 이야기'가 인기가 많으면 다수의 복사본으로 수요에 대응하는 방식이다.


## DNS(Domain Name System)

- 인간 친화적인 호스트네임을 머신에 적합한 IP 주소로 변환
  - 예) www.google.com → 172.217.18.36
- 계층적 이름 구조 사용(상위 → 하위)
  - 예) com → google.com → www.google.com

### Route 53

- 고가용성, 확장성, 완전관리형 DNS
- Domain Registrar(도메인 등록을 돕는 기업, 서비스), 즉 도메인 등록이 가능함
- 리소스 헬스체크 기능 제공
- 100% 가용성 보장

> #### 완전관리형
> 
> AWS가 세부적인 것까지 모두 만들었기에 사용자는 이를 신경쓸 필요가 없는 것